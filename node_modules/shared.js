const fs = require('fs');
const inspector = require('inspector');
const query = require('querystring');
const util = require('util');

inspector.Session.prototype.postAsync =
  util.promisify(inspector.Session.prototype.post);

exports.ReadFile = async function ReadFile(file_name) {
  return (await util.promisify(fs.readFile)(file_name)).toString();
}

exports.GetPostBody = async function GetPostBody(request) {
  return new Promise(function(resolve) {
    let body = "";
    request.on('data', data => body += data);
    request.on('end', end => resolve(query.parse(body)));
  });
}

// Reformat string for HTML.
exports.Escape = function Escape(string) {
  return [
    ["&", "&amp;"],
    [" ", "&nbsp;"],
    ["<", "&lt;"],
    [">", "&gt;"],
    ["\r\n", "<br/>"],
    ["\n", "<br/>"],
    ["\"", "&quot;"],
  ].reduce(
    function(string, [pattern, replacement]) {
      return string.replace(new RegExp(pattern, "g"), replacement);
    }, string);
}
